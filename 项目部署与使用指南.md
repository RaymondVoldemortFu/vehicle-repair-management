# 车辆维修管理系统 - 部署与使用指南

## 项目概述

车辆维修管理系统是一个完整的前后端分离项目，包含用户端、管理员端和维修工人端三个子系统。系统支持车辆管理、维修订单管理、工人管理、材料库存管理等功能。

## 系统架构

- **后端**: FastAPI + Python 3.8+
- **前端**: Vue 3 + Element Plus + Vite
- **数据库**: PostgreSQL/MySQL (支持多种数据库)
- **认证**: JWT Token 认证

## 完整部署指南

### 1. 环境准备

#### macOS 系统

```bash
# 安装 Homebrew (如果没有安装)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Python 3.8+
brew install python@3.9

# 安装 Node.js 16+
brew install node

# 安装 PostgreSQL (可选)
brew install postgresql
brew services start postgresql
```

#### Windows 系统

1. **安装 Python**
   - 下载 Python 3.8+ 从 https://python.org
   - 安装时勾选 "Add Python to PATH"

2. **安装 Node.js**
   - 下载 Node.js LTS 版本从 https://nodejs.org
   - 安装时勾选 "Add to PATH"

3. **安装数据库**
   - 下载 PostgreSQL 从 https://postgresql.org
   - 或使用 MySQL 从 https://mysql.com

### 2. 后端部署

```bash
# 进入后端目录
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 配置数据库连接
cp app/config/settings.py.example app/config/settings.py
# 编辑 settings.py 配置数据库连接信息

# 初始化数据库
python run_migration.py

# 启动后端服务
python -m app.main
# 或
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

后端服务将在 http://localhost:8000 启动

### 3. 前端部署

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install
# 或使用 yarn
yarn install

# 开发环境启动
npm run dev
# 或
yarn dev

# 生产环境构建
npm run build
# 或
yarn build
```

前端服务将在 http://localhost:3000 启动

### 4. 数据库配置

#### PostgreSQL 配置示例

```python
# backend/app/config/settings.py
DATABASE_URL = "postgresql://username:password@localhost:5432/vehicle_repair_db"
```

#### MySQL 配置示例

```python
# backend/app/config/settings.py
DATABASE_URL = "mysql+pymysql://username:password@localhost:3306/vehicle_repair_db"
```

## 系统使用指南

### 默认账号信息

系统初始化后会创建以下默认账号：

#### 管理员账号
- 用户名: `admin`
- 密码: `admin123`
- 权限: 系统全部功能

#### 测试用户账号
- 用户名: `testuser`
- 密码: `test123`
- 权限: 用户端功能

#### 测试工人账号
- 工号: `WORKER001`
- 密码: `worker123`
- 权限: 维修工人端功能

### 业务流程详解

#### 1. 用户使用流程

1. **用户注册**
   ```
   访问系统 → 点击注册 → 填写用户信息 → 提交注册 → 登录系统
   ```

2. **添加车辆**
   ```
   登录 → 我的车辆 → 添加车辆 → 填写车辆信息 → 保存
   ```

3. **创建维修订单**
   ```
   选择车辆 → 描述故障 → 选择优先级 → 提交订单 → 等待处理
   ```

4. **跟踪订单状态**
   ```
   查看订单列表 → 查看详情 → 跟踪进度 → 确认完成
   ```

#### 2. 管理员使用流程

1. **订单管理**
   ```
   查看待处理订单 → 分配维修工人 → 更新订单状态 → 完成订单
   ```

2. **工人管理**
   ```
   添加维修工人 → 设置技能等级 → 分配工作任务 → 管理工资
   ```

3. **库存管理**
   ```
   查看材料库存 → 添加新材料 → 更新库存数量 → 设置预警阈值
   ```

4. **数据分析**
   ```
   查看统计报表 → 分析业务趋势 → 导出数据报告
   ```

#### 3. 维修工人使用流程

1. **查看工作任务**
   ```
   登录工作台 → 查看分配的订单 → 查看订单详情
   ```

2. **处理维修订单**
   ```
   开始维修 → 记录维修过程 → 使用材料登记 → 完成维修
   ```

3. **查看工资**
   ```
   查看月度工资 → 查看工作统计 → 下载工资单
   ```

### API 文档

后端启动后，可以通过以下地址查看API文档：

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 系统功能模块

#### 用户管理模块
- 用户注册、登录、权限管理
- 个人信息维护
- 密码修改

#### 车辆管理模块
- 车辆信息录入、编辑、删除
- 车辆状态管理
- 车辆查询和统计

#### 订单管理模块
- 维修订单创建、查看、更新
- 订单状态流转
- 订单分配和调度

#### 工人管理模块
- 维修工人信息管理
- 技能等级管理
- 工作量统计

#### 库存管理模块
- 材料库存管理
- 入库出库记录
- 库存预警

#### 财务管理模块
- 工资计算和发放
- 收入统计
- 财务报表

#### 系统管理模块
- 管理员管理
- 系统配置
- 日志管理

## 常见问题解决

### 1. 后端启动失败

**问题**: 数据库连接失败
```bash
# 检查数据库服务是否启动
# PostgreSQL
brew services list | grep postgresql

# 检查数据库连接配置
# 编辑 backend/app/config/settings.py
```

**问题**: 端口被占用
```bash
# 查找占用端口的进程
lsof -i :8000  # macOS
netstat -ano | findstr :8000  # Windows

# 终止进程或更改端口
```

### 2. 前端启动失败

**问题**: 依赖安装失败
```bash
# 清除缓存重新安装
rm -rf node_modules package-lock.json
npm install
```

**问题**: 网络代理问题
```bash
# 设置 npm 代理
npm config set registry https://registry.npmmirror.com
```

### 3. 数据库相关问题

**问题**: 数据库初始化失败
```bash
# 检查数据库权限
# 确保数据库用户有创建表的权限

# 手动运行迁移
cd backend
python run_migration.py
```

### 4. 权限和认证问题

**问题**: 登录后没有权限
- 检查用户角色是否正确分配
- 确认 JWT token 是否有效
- 查看后端日志确认权限验证逻辑

## 生产环境部署

### 1. 后端生产部署

```bash
# 使用 gunicorn 启动
pip install gunicorn
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000

# 或使用 Docker
docker build -t vehicle-repair-backend .
docker run -d -p 8000:8000 vehicle-repair-backend
```

### 2. 前端生产部署

```bash
# 构建生产版本
npm run build

# 部署到 Nginx
cp -r dist/* /var/www/html/

# Nginx 配置示例
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/html;
    index index.html;
    
    location /api/ {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

### 3. 数据库优化

```sql
-- 创建索引优化查询性能
CREATE INDEX idx_orders_user_id ON repair_orders(user_id);
CREATE INDEX idx_orders_status ON repair_orders(status);
CREATE INDEX idx_orders_create_time ON repair_orders(create_time);
```

## 监控和维护

### 1. 日志管理

- 后端日志位置: `backend/logs/`
- 前端错误监控: 可集成 Sentry 等服务
- 数据库日志: 根据数据库配置

### 2. 备份策略

```bash
# 数据库备份 (PostgreSQL)
pg_dump -h localhost -U username vehicle_repair_db > backup.sql

# 数据库恢复
psql -h localhost -U username vehicle_repair_db < backup.sql
```

### 3. 性能监控

- API 响应时间监控
- 数据库查询性能
- 前端加载速度
- 系统资源使用率

## 技术支持

如遇到问题，可以通过以下方式获取帮助：

1. 查看项目 README 文档
2. 检查系统日志
3. 查看 API 文档
4. 提交 Issue 或联系开发团队

## 更新日志

### v1.0.0 (当前版本)
- 完整的用户管理系统
- 车辆和订单管理功能
- 维修工人管理
- 基础的库存管理
- 工资管理功能
- 数据统计和分析

### 计划功能
- 移动端 APP
- 实时通知系统
- 更详细的报表功能
- 第三方支付集成
- 客户评价系统 